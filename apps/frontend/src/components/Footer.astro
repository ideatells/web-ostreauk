---
import { fetchGlobalSettings, fetchPages } from '../lib/strapi';
import type { Locale } from '../lib/strapi';

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;

const [pagesResponse, globalSettings] = await Promise.all([
  fetchPages(locale),
  fetchGlobalSettings(locale),
]);

const quickLinks = pagesResponse.data.filter((page) => page.show_in_nav);
const ctaText = globalSettings?.cta_button_text ?? 'Contact';
const ctaUrl = globalSettings?.cta_button_url ?? `/${locale}/contact`;
const footerText = globalSettings?.footer_text ?? `Â© ${new Date().getFullYear()} Ostrea`;
const phoneNumber = globalSettings?.phone_number ?? '';
const email = globalSettings?.email ?? '';
const address = globalSettings?.address ?? '';

function formatPhoneForTel(phone: string): string {
  return phone.replace(/[^\d+]/g, '');
}
---

<footer class="bg-slate-50 py-12" aria-label="Site footer">
  <div class="mx-auto grid max-w-7xl grid-cols-1 gap-8 px-4 md:grid-cols-3 md:px-6">
    <section>
      <h2 class="mb-4 text-lg font-semibold text-brand-brown">Contact</h2>
      <div class="space-y-3 text-sm text-slate-700">
        {
          phoneNumber && (
            <a href={`tel:${formatPhoneForTel(phoneNumber)}`} class="inline-flex items-center gap-2">
              <svg
                class="h-4 w-4"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.63-3.07 19.3 19.3 0 0 1-6-6A19.8 19.8 0 0 1 2.12 4.18 2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.12.9.33 1.78.61 2.62a2 2 0 0 1-.45 2.11L8 9.91a16 16 0 0 0 6.09 6.09l1.46-1.27a2 2 0 0 1 2.11-.45c.84.28 1.72.49 2.62.61A2 2 0 0 1 22 16.92z" />
              </svg>
              <span>{phoneNumber}</span>
            </a>
          )
        }

        {
          email && (
            <a href={`mailto:${email}`} class="inline-flex items-center gap-2">
              <svg
                class="h-4 w-4"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <path d="M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" />
                <path d="m22 6-10 7L2 6" />
              </svg>
              <span>{email}</span>
            </a>
          )
        }

        {
          address && (
            <p class="inline-flex whitespace-pre-line">
              <span class="mr-2 mt-0.5 inline-flex shrink-0">
                <svg
                  class="h-4 w-4"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  aria-hidden="true"
                >
                  <path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 1 1 18 0z" />
                  <circle cx="12" cy="10" r="3" />
                </svg>
              </span>
              <span>{address}</span>
            </p>
          )
        }
      </div>
    </section>

    <section>
      <h2 class="mb-4 text-lg font-semibold text-brand-brown">Quick links</h2>
      <ul class="space-y-2 text-sm">
        {
          quickLinks.map((page) => (
            <li>
              <a href={`/${locale}/${page.slug}`} class="font-medium text-brand-green hover:text-brand-green-dark">
                {page.title}
              </a>
            </li>
          ))
        }
      </ul>
    </section>

    <section>
      <h2 class="mb-4 text-lg font-semibold text-brand-brown">Start now</h2>
      <a
        href={ctaUrl}
        class="inline-flex items-center justify-center rounded-md bg-brand-green px-5 py-2.5 text-sm font-semibold text-white transition-colors hover:bg-brand-green-dark"
      >
        {ctaText}
      </a>
    </section>
  </div>

  <div class="mx-auto mt-10 max-w-7xl border-t border-slate-200 px-4 pt-6 text-center text-sm text-slate-500 md:px-6">
    {footerText}
  </div>
</footer>
