---
import BlogCard from '../../components/BlogCard.astro';
import Hero from '../../components/Hero.astro';
import ServiceCard from '../../components/ServiceCard.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { fetchBlogPosts, fetchGlobalSettings, fetchPageBySlug, type Locale } from '../../lib/strapi';
import { getTranslations, validateLocale } from '../../lib/i18n';

export function getStaticPaths() {
  return [{ params: { lang: 'nl' } }, { params: { lang: 'en' } }];
}

const langParam = Astro.params.lang ?? 'nl';

if (!validateLocale(langParam)) {
  throw new Error(`Unsupported locale: ${langParam}`);
}

const lang: Locale = langParam;
const t = getTranslations(lang);

const [homePage, homepagePage, globalSettings, recentPostsResponse] = await Promise.all([
  fetchPageBySlug('home', lang),
  fetchPageBySlug('homepage', lang),
  fetchGlobalSettings(lang),
  fetchBlogPosts(lang, 1, 3),
]);

const page = homePage ?? homepagePage;
const pageTitle = page?.seo?.seo_title || page?.title || `${globalSettings?.site_name || 'Ostrea'} - Home`;
const pageDescription =
  page?.seo?.seo_description ||
  page?.hero_subtitle ||
  `${globalSettings?.site_name || 'Ostrea'} ${lang === 'nl' ? 'homepage' : 'home page'}`;

const services =
  lang === 'nl'
    ? [
        {
          title: t.serviceType.bedrijfsjuristen,
          description: 'Praktische juridische ondersteuning voor ondernemers en bedrijven.',
          href: `/${lang}/bedrijfsjuristen`,
          icon: 'M12 2a2 2 0 0 0-2 2v2H7a2 2 0 0 0-2 2v3h14V8a2 2 0 0 0-2-2h-3V4a2 2 0 0 0-2-2Zm-1 4V4h2v2h-2Zm-6 7v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-7H5Z',
        },
        {
          title: t.serviceType.trust_formation,
          description: 'Begeleiding bij truststructuren en internationale bedrijfsopzet.',
          href: `/${lang}/trust-formation`,
          icon: 'M12 3 4 7v5c0 5.5 3.8 9.7 8 11 4.2-1.3 8-5.5 8-11V7l-8-4Zm0 3.2 5 2.5V12c0 3.8-2.4 6.8-5 8-2.6-1.2-5-4.2-5-8V8.7l5-2.5Z',
        },
        {
          title: t.serviceType.belastingadvies,
          description: 'Fiscaal advies op maat voor ondernemers en internationale structuren.',
          href: `/${lang}/belastingadvies`,
          icon: 'M12 2 3 6v6c0 5 3.8 9.5 9 12 5.2-2.5 9-7 9-12V6l-9-4Zm-1 6h2v6h-2V8Zm0 8h2v2h-2v-2Z',
        },
      ]
    : [
        {
          title: t.serviceType.bedrijfsjuristen,
          description: 'Practical legal support for entrepreneurs and growing companies.',
          href: `/${lang}/business-lawyers`,
          icon: 'M12 2a2 2 0 0 0-2 2v2H7a2 2 0 0 0-2 2v3h14V8a2 2 0 0 0-2-2h-3V4a2 2 0 0 0-2-2Zm-1 4V4h2v2h-2Zm-6 7v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-7H5Z',
        },
        {
          title: t.serviceType.trust_formation,
          description: 'Guidance on trust structures and international company setup.',
          href: `/${lang}/trust-formation`,
          icon: 'M12 3 4 7v5c0 5.5 3.8 9.7 8 11 4.2-1.3 8-5.5 8-11V7l-8-4Zm0 3.2 5 2.5V12c0 3.8-2.4 6.8-5 8-2.6-1.2-5-4.2-5-8V8.7l5-2.5Z',
        },
        {
          title: t.serviceType.belastingadvies,
          description: 'Tailored tax advisory for businesses and cross-border structures.',
          href: `/${lang}/tax-advisory`,
          icon: 'M12 2 3 6v6c0 5 3.8 9.5 9 12 5.2-2.5 9-7 9-12V6l-9-4Zm-1 6h2v6h-2V8Zm0 8h2v2h-2v-2Z',
        },
      ];
---

<BaseLayout title={pageTitle} description={pageDescription} lang={lang}>
  <Hero
    title={page?.hero_title || page?.title || (lang === 'nl' ? 'Welkom bij Ostrea' : 'Welcome to Ostrea')}
    subtitle={page?.hero_subtitle || undefined}
    image={page?.hero_image || null}
    imageAlt={page?.hero_title || page?.title || 'Hero image'}
  />

  <section class="mx-auto max-w-7xl px-4 py-12 md:py-16">
    <h2 class="text-2xl font-bold text-slate-900 md:text-3xl">
      {lang === 'nl' ? 'Onze diensten' : 'Our services'}
    </h2>
    <div class="mt-6 grid grid-cols-1 gap-6 md:grid-cols-3">
      {services.map((service) => <ServiceCard {...service} />)}
    </div>
  </section>

  <section class="mx-auto max-w-7xl px-4 py-12 md:py-16">
    <div class="mb-6 flex items-end justify-between gap-4">
      <h2 class="text-2xl font-bold text-slate-900 md:text-3xl">
        {lang === 'nl' ? 'Recente blogberichten' : 'Recent blog posts'}
      </h2>
      <a class="text-sm font-medium text-brand-green hover:text-brand-green-dark" href={`/${lang}/blog`}>
        {lang === 'nl' ? 'Bekijk alle berichten' : 'View all posts'}
      </a>
    </div>
    <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
      {recentPostsResponse.data.map((post) => <BlogCard post={post} locale={lang} />)}
    </div>
  </section>

  <section class="mx-auto max-w-7xl px-4 pb-12 md:pb-16">
    <div class="rounded-2xl bg-slate-900 px-6 py-12 text-center text-white md:px-10">
      <h2 class="text-2xl font-bold md:text-3xl">
        {lang === 'nl' ? 'Klaar om te starten?' : 'Ready to get started?'}
      </h2>
      <p class="mx-auto mt-3 max-w-2xl text-slate-200">
        {lang === 'nl'
          ? 'Neem contact op voor juridisch en fiscaal advies dat past bij uw onderneming.'
          : 'Get in touch for legal and tax advisory tailored to your business.'}
      </p>
      <a
        href={globalSettings?.cta_button_url || `/${lang}/contact`}
        class="mt-6 inline-flex items-center rounded-md bg-brand-green px-5 py-3 text-sm font-semibold text-white hover:bg-brand-green-dark"
      >
        {globalSettings?.cta_button_text || (lang === 'nl' ? 'Neem contact op' : 'Contact us')}
      </a>
    </div>
  </section>
</BaseLayout>
